<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Node discovery for `super::Endpoint`."><title>Discovery in iroh::discovery - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-46f98efaafac5295.ttf.woff2,FiraSans-Regular-018c141bf0843ffd.woff2,FiraSans-Medium-8f9a781e4970d388.woff2,SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2,SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-b21aa549bf6d91ff.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="iroh" data-themes="" data-resource-suffix="" data-rustdoc-version="1.80.0-nightly (c987ad527 2024-05-01)" data-channel="nightly" data-search-js="search-bf21c90c8c1d92b1.js" data-settings-js="settings-4313503d2e1961c2.js" ><script src="../../static.files/storage-e32f0c247825364d.js"></script><script defer src="sidebar-items.js"></script><script defer src="../../static.files/main-20a3ad099b048cf2.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-09095024cf37855e.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc trait"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle" title="show sidebar"></button></nav><nav class="sidebar"><div class="sidebar-crate"><h2><a href="../../iroh/index.html">iroh</a><span class="version">0.29.0</span></h2></div><h2 class="location"><a href="#">Discovery</a></h2><div class="sidebar-elems"><section><h3><a href="#provided-methods">Provided Methods</a></h3><ul class="block"><li><a href="#method.publish">publish</a></li><li><a href="#method.resolve">resolve</a></li><li><a href="#method.subscribe">subscribe</a></li></ul><h3><a href="#implementors">Implementors</a></h3></section><h2><a href="index.html">In iroh::discovery</a></h2></div></nav><div class="sidebar-resizer"></div><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><div id="sidebar-button" tabindex="-1"><a href="../../iroh/all.html" title="show sidebar"></a></div><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Type ‘S’ or ‘/’ to search, ‘?’ for more options…" type="search"><div id="help-button" tabindex="-1"><a href="../../help.html" title="help">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings">Settings</a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Trait <a href="../index.html">iroh</a>::<wbr><a href="index.html">discovery</a>::<wbr><a class="trait" href="#">Discovery</a><button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><span class="out-of-band"><a class="src" href="../../src/iroh/discovery.rs.html#149-196">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><pre class="rust item-decl"><code>pub trait Discovery: <a class="trait" href="https://doc.rust-lang.org/nightly/core/fmt/trait.Debug.html" title="trait core::fmt::Debug">Debug</a> + <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Send.html" title="trait core::marker::Send">Send</a> + <a class="trait" href="https://doc.rust-lang.org/nightly/core/marker/trait.Sync.html" title="trait core::marker::Sync">Sync</a> {
    // Provided methods
    fn <a href="#method.publish" class="fn">publish</a>(&amp;self, _info: &amp;<a class="struct" href="../struct.AddrInfo.html" title="struct iroh::AddrInfo">AddrInfo</a>) { ... }
<span class="item-spacer"></span>    fn <a href="#method.resolve" class="fn">resolve</a>(
        &amp;self,
        _endpoint: <a class="struct" href="../endpoint/struct.Endpoint.html" title="struct iroh::endpoint::Endpoint">Endpoint</a>,
        _node_id: <a class="type" href="../type.NodeId.html" title="type iroh::NodeId">NodeId</a>
    ) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;BoxStream&lt;<a class="type" href="https://docs.rs/anyhow/1.0.93/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="struct" href="struct.DiscoveryItem.html" title="struct iroh::discovery::DiscoveryItem">DiscoveryItem</a>&gt;&gt;&gt; { ... }
<span class="item-spacer"></span>    fn <a href="#method.subscribe" class="fn">subscribe</a>(&amp;self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;BoxStream&lt;<a class="struct" href="struct.DiscoveryItem.html" title="struct iroh::discovery::DiscoveryItem">DiscoveryItem</a>&gt;&gt; { ... }
}</code></pre><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Node discovery for <a href="../endpoint/struct.Endpoint.html" title="struct iroh::endpoint::Endpoint"><code>super::Endpoint</code></a>.</p>
<p>This trait defines publishing and resolving addressing information for a <a href="../type.NodeId.html" title="type iroh::NodeId"><code>NodeId</code></a>.
This enables connecting to other nodes with only knowing the <a href="../type.NodeId.html" title="type iroh::NodeId"><code>NodeId</code></a>, by using this
<a href="trait.Discovery.html" title="trait iroh::discovery::Discovery"><code>Discovery</code></a> system to look up the actual addressing information.  It is common for
implementations to require each node to publish their own information before it can be
looked up by other nodes.</p>
<p>The published addressing information can include both a <a href="../struct.RelayUrl.html" title="struct iroh::RelayUrl"><code>RelayUrl</code></a> and/or direct
addresses.</p>
<p>To allow for discovery, the <a href="../endpoint/struct.Endpoint.html" title="struct iroh::endpoint::Endpoint"><code>super::Endpoint</code></a> will call <code>publish</code> whenever
discovery information changes. If a discovery mechanism requires a periodic
refresh, it should start its own task.</p>
</div></details><h2 id="provided-methods" class="section-header">Provided Methods<a href="#provided-methods" class="anchor">§</a></h2><div class="methods"><details class="toggle method-toggle" open><summary><section id="method.publish" class="method"><a class="src rightside" href="../../src/iroh/discovery.rs.html#157">source</a><h4 class="code-header">fn <a href="#method.publish" class="fn">publish</a>(&amp;self, _info: &amp;<a class="struct" href="../struct.AddrInfo.html" title="struct iroh::AddrInfo">AddrInfo</a>)</h4></section></summary><div class="docblock"><p>Publishes the given <a href="../struct.AddrInfo.html" title="struct iroh::AddrInfo"><code>AddrInfo</code></a> to the discovery mechanism.</p>
<p>This is fire and forget, since the <a href="../endpoint/struct.Endpoint.html" title="struct iroh::endpoint::Endpoint"><code>Endpoint</code></a> can not wait for successful
publishing. If publishing is async, the implementation should start it’s own task.</p>
<p>This will be called from a tokio task, so it is safe to spawn new tasks.
These tasks will be run on the runtime of the <a href="../endpoint/struct.Endpoint.html" title="struct iroh::endpoint::Endpoint"><code>super::Endpoint</code></a>.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.resolve" class="method"><a class="src rightside" href="../../src/iroh/discovery.rs.html#163-169">source</a><h4 class="code-header">fn <a href="#method.resolve" class="fn">resolve</a>(
    &amp;self,
    _endpoint: <a class="struct" href="../endpoint/struct.Endpoint.html" title="struct iroh::endpoint::Endpoint">Endpoint</a>,
    _node_id: <a class="type" href="../type.NodeId.html" title="type iroh::NodeId">NodeId</a>
) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;BoxStream&lt;<a class="type" href="https://docs.rs/anyhow/1.0.93/anyhow/type.Result.html" title="type anyhow::Result">Result</a>&lt;<a class="struct" href="struct.DiscoveryItem.html" title="struct iroh::discovery::DiscoveryItem">DiscoveryItem</a>&gt;&gt;&gt;</h4></section></summary><div class="docblock"><p>Resolves the <a href="../struct.AddrInfo.html" title="struct iroh::AddrInfo"><code>AddrInfo</code></a> for the given <a href="../type.NodeId.html" title="type iroh::NodeId"><code>NodeId</code></a>.</p>
<p>Once the returned [<code>BoxStream</code>] is dropped, the service should stop any pending
work.</p>
</div></details><details class="toggle method-toggle" open><summary><section id="method.subscribe" class="method"><a class="src rightside" href="../../src/iroh/discovery.rs.html#193-195">source</a><h4 class="code-header">fn <a href="#method.subscribe" class="fn">subscribe</a>(&amp;self) -&gt; <a class="enum" href="https://doc.rust-lang.org/nightly/core/option/enum.Option.html" title="enum core::option::Option">Option</a>&lt;BoxStream&lt;<a class="struct" href="struct.DiscoveryItem.html" title="struct iroh::discovery::DiscoveryItem">DiscoveryItem</a>&gt;&gt;</h4></section></summary><div class="docblock"><p>Subscribe to all addresses that get <em>passively</em> discovered.</p>
<p>An implementation may choose to defer emitting passively discovered nodes
until the stream is actually polled. To avoid missing discovered nodes,
poll the stream as soon as possible.</p>
<p>If you do not regularly poll the stream, you may miss discovered nodes.</p>
<p>Any discovery systems that only discover when explicitly resolving a
specific <a href="../type.NodeId.html" title="type iroh::NodeId"><code>NodeId</code></a> do not need to implement this method. Any nodes or
addresses that are discovered by calling <code>resolve</code> should NOT be added
to the <code>subscribe</code> stream.</p>
<p>Discovery systems that are capable of receiving information about <a href="../type.NodeId.html" title="type iroh::NodeId"><code>NodeId</code></a>s
and their <a href="../struct.AddrInfo.html" title="struct iroh::AddrInfo"><code>AddrInfo</code></a>s without explicitly calling <code>resolve</code>, i.e.,
systems that do “passive” discovery, should implement this method. If
<code>subscribe</code> is called multiple times, the passively discovered addresses
should be sent on all streams.</p>
<p>The <a href="../endpoint/struct.Endpoint.html" title="struct iroh::endpoint::Endpoint"><code>crate::endpoint::Endpoint</code></a> will <code>subscribe</code> to the discovery system
and add the discovered addresses to the internal address book as they arrive
on this stream.</p>
</div></details></div><h2 id="implementors" class="section-header">Implementors<a href="#implementors" class="anchor">§</a></h2><div id="implementors-list"><section id="impl-Discovery-for-DnsDiscovery" class="impl"><a class="src rightside" href="../../src/iroh/discovery/dns.rs.html#69-87">source</a><a href="#impl-Discovery-for-DnsDiscovery" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="trait.Discovery.html" title="trait iroh::discovery::Discovery">Discovery</a> for <a class="struct" href="dns/struct.DnsDiscovery.html" title="struct iroh::discovery::dns::DnsDiscovery">DnsDiscovery</a></h3></section><section id="impl-Discovery-for-LocalSwarmDiscovery" class="impl"><a class="src rightside" href="../../src/iroh/discovery/local_swarm_discovery.rs.html#365-392">source</a><a href="#impl-Discovery-for-LocalSwarmDiscovery" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="trait.Discovery.html" title="trait iroh::discovery::Discovery">Discovery</a> for <a class="struct" href="local_swarm_discovery/struct.LocalSwarmDiscovery.html" title="struct iroh::discovery::local_swarm_discovery::LocalSwarmDiscovery">LocalSwarmDiscovery</a></h3><span class="item-info"><div class="stab portability">Available on <strong>crate feature <code>discovery-local-network</code></strong> only.</div></span></section><section id="impl-Discovery-for-DhtDiscovery" class="impl"><a class="src rightside" href="../../src/iroh/discovery/pkarr/dht.rs.html#364-401">source</a><a href="#impl-Discovery-for-DhtDiscovery" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="trait.Discovery.html" title="trait iroh::discovery::Discovery">Discovery</a> for <a class="struct" href="pkarr/dht/struct.DhtDiscovery.html" title="struct iroh::discovery::pkarr::dht::DhtDiscovery">DhtDiscovery</a></h3><span class="item-info"><div class="stab portability">Available on <strong>crate feature <code>discovery-pkarr-dht</code></strong> only.</div></span></section><section id="impl-Discovery-for-PkarrPublisher" class="impl"><a class="src rightside" href="../../src/iroh/discovery/pkarr.rs.html#210-214">source</a><a href="#impl-Discovery-for-PkarrPublisher" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="trait.Discovery.html" title="trait iroh::discovery::Discovery">Discovery</a> for <a class="struct" href="pkarr/struct.PkarrPublisher.html" title="struct iroh::discovery::pkarr::PkarrPublisher">PkarrPublisher</a></h3></section><section id="impl-Discovery-for-PkarrResolver" class="impl"><a class="src rightside" href="../../src/iroh/discovery/pkarr.rs.html#336-357">source</a><a href="#impl-Discovery-for-PkarrResolver" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="trait.Discovery.html" title="trait iroh::discovery::Discovery">Discovery</a> for <a class="struct" href="pkarr/struct.PkarrResolver.html" title="struct iroh::discovery::pkarr::PkarrResolver">PkarrResolver</a></h3></section><section id="impl-Discovery-for-StaticProvider" class="impl"><a class="src rightside" href="../../src/iroh/discovery/static_provider.rs.html#133-162">source</a><a href="#impl-Discovery-for-StaticProvider" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="trait.Discovery.html" title="trait iroh::discovery::Discovery">Discovery</a> for <a class="struct" href="static_provider/struct.StaticProvider.html" title="struct iroh::discovery::static_provider::StaticProvider">StaticProvider</a></h3></section><section id="impl-Discovery-for-ConcurrentDiscovery" class="impl"><a class="src rightside" href="../../src/iroh/discovery.rs.html#251-283">source</a><a href="#impl-Discovery-for-ConcurrentDiscovery" class="anchor">§</a><h3 class="code-header">impl <a class="trait" href="trait.Discovery.html" title="trait iroh::discovery::Discovery">Discovery</a> for <a class="struct" href="struct.ConcurrentDiscovery.html" title="struct iroh::discovery::ConcurrentDiscovery">ConcurrentDiscovery</a></h3></section></div><script src="../../trait.impl/iroh/discovery/trait.Discovery.js" async></script></section></div></main></body></html>