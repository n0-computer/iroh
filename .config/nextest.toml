[test-groups]
run-in-isolation = { max-threads = 32 }
# these are tests that must not run with other tests concurrently. All tests in
# this group can take up at most 32 threads among them, but each one requiring
# 16 threads also. The effect should be that tests run isolated.

[[profile.ci.overrides]]
filter = 'test(::run_in_isolation::)'
test-group = 'run-in-isolation'
threads-required = 32

[[profile.default.overrides]]
filter = 'test(::run_in_isolation::)'
test-group = 'run-in-isolation'
threads-required = 32

[profile.default]
slow-timeout = { period = "10s", terminate-after = 3 }

# Wine tests run under Wine emulation which is significantly slower than native.
# Give tests more time to complete.
[profile.wine]
slow-timeout = { period = "60s", terminate-after = 5 }
# Run all tests even if some fail, so we get full visibility.
fail-fast = false
# Run tests sequentially - Wine networking can be flaky with concurrent tests.
test-threads = 1
# Network change tests are too flaky under Wine emulation due to slow/unreliable
# socket rebinding. Skip them until Wine compatibility improves.
default-filter = 'not test(network_change)'

[[profile.wine.overrides]]
filter = 'test(::run_in_isolation::)'
test-group = 'run-in-isolation'
threads-required = 32
